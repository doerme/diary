# evaluation strategy in JS && HTTP gateway

## evaluation strategy
任何语言都有求值策略，比如按值传递或是按引用传递。按值传递也就是将值进行一个复制操作，任何对这个值的操作都不影响原值。
```
bar = 10

produce foo(barVal) {
  barVal = 20
  end
}

foo(bar);

print bar; // 10
```
值传递好用，它并不影响原值，但是有个问题就是如果是一个复杂的类型，比如数组或者对象，如果他们的层级嵌套很深，那么进行值传递会造成一定的性能损耗与浪费。值传递会将这些复杂的对象复制一次，即使它只需要
修改某几个数据项。 
按引用传递，是将地址传递到其他地方中，由于地址相同，修改的地方是相同的，会影响原值的值。
```
foo = {
  x: 1,
  y: 2
}

produce bar(obj, isfirst) {

  if isfirst
  obj = {
    x: 100,
    y: 200
  }
  else
  obj.x = 1000;
  obj.y = 2000;
}

bar(foo, true);

foo;  // { x: 100, y: 200 }

bar(foo, false);

foo; //{ x: 1000, y: 2000 }
```
指向的是同一个地方, 所以修改的是同一个地方，在取值的时候获取的是同一个值。
而在 Javascript 中，引用传递并非这么简单，它是按共享传递，也就是在函数传参的时候，形参接受的是对象地址的拷贝。
也就是说如果在函数中对形参进行修改操作，那么修改就会反映到原值中去，但是如果对形参重新赋值，那么对原值没有影响（因为改变了地址）
```
produce foo(barVal, isChange) {

  if(isChange) {
    barVal = {
      x: 100,
      y: 200
    }
  }

  barVal.x = 1000;
  barVal.y = 2000;
}

bar = {
  x: 1,
  y: 2
}

foo(bar)

print(bar)  // {x: 1000, y: 2000}

for(bar, true);

print(bar)  // { x: 1000, y: 2000 }

```
简单地来说，就是函数参数也是值传递，只不过对于对象而言，是地址的复制值。如果进行修改那么就是修改了内外共同引用的那个内存空间。
但是如果对内部形参进行重新赋值，那么这个时候形参存储的就不是之前的传入对象的地址，而是一个新的地址，所以无法修改到原对象，且原对象也不受影响。

## HTTP gateway
HTTP 有关于网关的概念, 网关可以看作是一个翻译器, 一个应用程序与资源之间的粘合剂.像协议网关, 可以在客户端, 服务端两端链接不同的两种协议, 比如应用程序通过 ftp 协议来获取资源, 但是网关与服务端之间可以使用 http 来获取资源.或者应用程序与网关之间使用 HTTPS 协议保证数据安全, 但是网关与内部的服务端之间可以使用比较轻简的 HTTP 协议, 因为内部服务器不可被外部访问, 所以不用处处使用 HTTPS, 并且好处在于网关可以统一地使用一些认证或者链接, 比较好地集中解决问题.
CGI, 通用网关接口就是我们常用的接口 API.
网关中有隧道的概念, 也就是将非 HTTP 协议的内容嵌在 HTTP 协议中, 传输到服务器上.比如之前我使用的那个 DELETE, PUT 这种 restful HTTP 方法, 它会先发送一个 OPTIONS 方法到服务器上, 就是为了询问和确认服务器是否支持这类的 HTTP 方法, 其中的原理就是通过 OPTIONS 请求建立一个隧道, 也就是通过 OPTIONS 建立起 TCP 隧道(TCP 三次握手), 然后内容在这个隧道中传输.像 SSL 的建立就可以通过 SSL 隧道来建立, 因为路由器之前有可能会存在一些防火墙, 而防火墙可能会屏蔽了 443 端口, 那么我们此时就可以通过使用 HTTP 的 80 端口发送一个建立 SSL 隧道的请求, 得以使用 HTTPS 链接服务器. 缺点在于与那些直接使用 HTTPS 链接(SSL 通道)的网关服务器来说, 这样的 SSL 隧道因为客户端与网关之间是 HTTP 协议, 可能会导致一个恶意用户借助这个打开了一些 telnet 会话.所以一般来说, 网关会使用认证与只开放某些特定端口.
对于 HTTP 中继, 也就是我们常见的一些代理服务器, 它的缺点在于可以在一些单跳的 HTTP 头部信息就没有传输到真正的服务器上, 导致服务器不能理解这条请求, 或者会关闭一些 keep-alive 的链接.